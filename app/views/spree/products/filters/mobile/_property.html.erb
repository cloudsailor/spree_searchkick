<% ::Spree::Property.filterable_properties.each do |property| %>
<% name_sym = property.filter_name.to_sym %>
<% id_str = "mobileFilters#{property.filter_name.capitalize}" %>
<% control_str = "mobileCollapseFilter#{property.filter_name.capitalize}" %>
<div class="card plp-overlay-card">
  <div class="card-header text-uppercase <%= 'collapsed' if params[property.filter_name].blank? %> plp-overlay-card-header" id="<%= id_str%>" data-toggle="collapse" data-target="#<%= control_str %>" aria-expanded="true" aria-controls="<%= control_str %>" role="heading" aria-level="3">
    <%= property.presentation %>
    <%= icon(name: 'arrow-right',
            classes: 'spree-icon-arrow spree-icon-arrow-right mt-1 float-right arrow plp-overlay-card-header-arrow',
            width: 16,
            height: 16) %>
  </div>
  <div id="<%= control_str %>" class="collapse <%= 'show' unless params[property.filter_name].blank? %>" aria-labelledby="<%= id_str %>" data-parent="#filters-accordion">
    <div class="card-body pt-1">
      <% property.filter_values.each do |val| %>
        <% val_lower = val.downcase %>
        <% prop_param_val = params[name_sym] == val_lower ? '' : val_lower %>
        <% prop_param = {menu_open: 1} %>
        <% prop_param[name_sym] = prop_param_val %>
        <%= link_to permitted_params.merge(prop_param), data: { params: prop_param, filter_name: name_sym } do %>
          <div class="d-inline-block py-1 px-2 m-1 text-uppercase plp-overlay-card-item <%= 'plp-overlay-card-item--selected' if params[name_sym] == val_lower %>">
            <%= val %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
<% end %>
