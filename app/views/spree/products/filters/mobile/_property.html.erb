<% ::Spree::Property.filterable.each do |property| %>
<% id_str = "mobileFilters#{property.filter_name.capitalize}" %>
<% control_str = "mobileCollapseFilter#{property.filter_name.capitalize}" %>
<div class="card plp-overlay-card">
  <div class="card-header text-uppercase <%= 'collapsed' if params[property.filter_name].blank? %> plp-overlay-card-header" id="<%= id_str%>" data-toggle="collapse" data-target="#<%= control_str %>" aria-expanded="true" aria-controls="<%= control_str %>" role="heading" aria-level="3">
    <%= property.presentation %>
    <%= icon(name: 'arrow-right',
            classes: 'spree-icon-arrow spree-icon-arrow-right mt-1 float-right arrow plp-overlay-card-header-arrow',
            width: 16,
            height: 16) %>
  </div>
  <div id="<%= control_str %>" class="collapse <%= 'show' unless params[property.filter_name].blank? %>" aria-labelledby="<%= id_str %>" data-parent="#filters-accordion">
    <div class="card-body pt-1">
      <% property.filter_values.each do |val| %>
        <%
          val_lower = val.downcase
          prop_param = {menu_open: 1}
          prop_param[property.filter_param] = params[property.filter_param] == val_lower ? nil : val_lower
        %>
        <%= link_to permitted_params.merge(prop_param).compact, data: { params: prop_param, filter_name: property.filter_param } do %>
          <div class="d-inline-block py-1 px-2 m-1 text-uppercase plp-overlay-card-item <%= 'plp-overlay-card-item--selected' if params[property.filter_param] == val_lower %>">
            <%= val %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
<% end %>
